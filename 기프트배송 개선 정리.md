# 기프트배송 개선 정리

##### 사이렌오더 MD 배송하기 진입후 뒤로가기시 웹뷰 닫기 기능 구현

2021-12-08 분석작업 

view_header.html 에서 뒤로가기 버튼을 호출해서 웹 뷰를 종료하는 closeWindow() 함수를 호출 해야한다.

```html
// fragmetns/view_header.html 
<!--
	queryParam :    headerTitle - 타이틀
                    headerType - 헤더 타입
    headerType :    TYPE1 - (배송메인) 타이틀, 검색, 장바구니, 닫기
                    TYPE2 - (상품목록) 뒤로가기, 타이틀, 검색, 장바구니, 닫기
                    TYPE3 - (팝업) 타이틀, 닫기
                    TYPE4 - No Header
                    TYPE5 - 뒤로가기, 닫기
                    TYPE6 - 배너
-->
<script th:inline="javascript">
    	
    	const onBackBtnHandler = () => { // 1.뒤로가기 버튼 누르면 fnHistoryBack() 호출된다.
            fnHistoryBack();
        }
        
        const closeWindow = () => {
            var pathname = location.pathname;
            if(headerType === 'TYPE3') window.close();
            if(pathname == '/main.do') {
                logout();
                sbGSHistory.clearHistory();
                location.href = 'starbuckskr://giftdelivery?main=screenclose';
                return;
            }
            if(openConfirm('popLayerConfirm', '배송하기를 종료하시겠어요?', () => {
                logout();
                location.href = 'starbuckskr://giftdelivery?main=screenclose';
                sbGSHistory.clearHistory();
            }));
        }


        const fnHistoryBack = () => {
            if(confirmAlertModalClose()){ // 주문내역의 현금영수증 등 모달이 필요한 화면
                return;
            }
            if(typeof(overrideHistoryBack) == 'function'){
                overrideHistoryBack();
                return;
            }
            if(headerType === 'TYPE3') { // 팝업
                window.close();
            } else if(headerType === 'TYPE1'){ // 2. 홈 (처음 진입화면,main) 
                logout();
                location.href = 'starbuckskr://giftdelivery?main=screenclose';
            } else { // 그 외 대부분의 경우
                sbGSHistory.back();
            }
        }
</script>

```

이거아님.



그냥 호출 한 곳의 딥링크 히스토리에 넣어두고 뒤로가기 누르면 이동해야한다.

체리 의 경우

```
location.href = "starbuckskr://deeplink?main=WHATS_NEW&sub=DETAIL&url="+encodeURIComponent("https://www.starbucks.co.kr/app/whats_new/news_view.do?seq=3967");

HOME : "starbuckskr://deeplink?main=HOME",
		CARD : "starbuckskr://deeplink?main=CARD",
		CLOSE : "starbuckskr://ondemand?appClose",
		LOC : "starbuckskr://ondemand?main=location",


```