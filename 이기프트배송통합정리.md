# 목차

-------------------------------



[TOC]

----------------------------------

## 작업 현황 정리

2021-08-03

> 182.173.169.66,67
> 404에러 조치방안 : /error_page.html 등 오류 페이지 웹서버 설정 추가
> 500에러 : /category/getItems.do url이 price건인지?,   /api/logout.do, /detail.do
> <WAS exception>
> java.lang.NullPointerException: null
> org.springframework.web.util.NestedServletException: Request processing failed; nested exception is java.lang.NullPointerException
> org.springframework.context.NoSuchMessageException: No message found under code 'PRD00' for locale 'ko_KR'. (8/1 was2)
> 2021-07-31 08:44:15.613  WARN 102220 --- [0 [olive01-235]] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.bind.UnsatisfiedServletRequestParameterException: Parameter conditions "giftNo" not met for actual request parameters: ] (7/31)

|      | 업무                                                         | 진행상황 | 담당자 |
| ---- | ------------------------------------------------------------ | -------- | ------ |
|      | 익셉션 대장 관리 및 익셉션 예외문구 정리해서 상현담당 전달 : GSEXception, No Matched action Url, |          |        |
|      | 공유폴더 및 컨플루언스 작성 대상 정리                        |          |        |
|      | 영진담당 별회수 건 확인                                      | 진행중   |        |
|      | VDI에서 SR, BO시스템 접속 가능하도록 방화벽 신청             | 진행중   |        |
|      | 부분반품건에 대해 현금영수증 발행날짜가 있는데 승인번호가 없어서 국세청에서 조회 안 됨 (주문번호, 구매확정일 확인해서 I/F 성공여부 확인 필요) |          |        |
|      | 텀쿠 LMS에 url 넣는거 SR에서 해주는건지? (현재는 쿠폰번호만 와서 앱에 직접 입력해야하는 불편함이 있음) -> 이석형 담당 확인 후 통보 해주기로함 (8/3) | 진행중   |        |
|      |                                                              |          |        |
|      |                                                              |          |        |
|      |                                                              |          |        |



20210805

#### 배송지 수정 해킹 시도

order/guest/detaildo?의 token 키를 배송지 수정에 가지고 가야 배송지 수정을 할 수 있도록 수정하면 될 것 같음.

> 선물받기 웹링크
> https://stg-www.starbucks.co.kr:3443/shipping/giftReceive.do?giftNo=827a2611462440389f76e54973ee34b1
>
> 인증 완료 이후 주문 및 배송조회 버튼을 클릭하면 gift_recieve.html 의 receive.go 가 실행되어 토큰키를 붙여서 다음 선물받기 상세 웹링크(location.origin + "/order/guest/detail.do?dlvyOrderNo=~~&tokenKey=!@#!@#"로 넘어 갈 수 있다.
>
> 어쨋든 선물받기 상세 웹링크를 컨트롤하는 OrderListcontroller 에서 Rquest Mapping을 통해 tokenKey를 체크한다. 
>
> 선물받기 상세 웹링크 : (인증성공하면 토큰키가 붙는다.), token 이 있어야 하지 않을까? 왜 @requestParam token = false 로 해두었을지 생각해보자.. 사용하는 곳 gift_reciveve(선물받기) 화면 밖에없다. true 로 해두어도 좋을 듯!
>
> 일단 OrderListController 에서 getOrderDetail의 tokenKey 를 true로 해두었음.
>
> https://stg-www.starbucks.co.kr:3443/order/guest/detail.do?dlvyOrderNo=D2021080513464495257&userId=20210805258875&tokenKey=kthWIVAPXNgQi8bgou94uKQv2PpnWFZqa%2FOFpfESUnc%3D
>
> 
>
> 정상 배송지 등록 주소 
> https://stg-www.starbucks.co.kr:3443/shipping/guest/register.do?dlvyOrderNo=D2021080513464495257&tokenKey=kthWIVAPXNgQi8bgou94uKQv2PpnWFZqa%2FOFpfESUnc%3D#!

배송지 수정은 : shipping_info_guest.html 에서 order.js의 onClickModifyShippingAddrGuest가 실행됨. 이때 dlvyOrderNo,srnm,userId가 붙는데 여기에 Token도 붙일 필요 있어보인다.

> 비정상 수정 주소 : get 방식으로 주문지 번호만 맞으면 아무렇게나 바꿀 수 있음.
> https://stg-www.starbucks.co.kr:3443/shipping/guest/modify.do?dlvyOrderNo=D2021080513464495257&srnm=${dlvyAdrsSrnm}&usrId=${userId}&headerType=TYPE4
>
> 비정상 수정 주소2 : get 방식으로 주문지 번호만 맞으면 아무렇게나 바꿀 수 있음.
> https://stg-www.starbucks.co.kr:3443/shipping/guest/modify.do?dlvyOrderNo=D2021080513464495257&srnm=${dlvyAdrsSrnm}&usrId=123
>
> order/guest/detaildo?의 token 키를 배송지 수정에 가지고 가야 배송지 수정을 할 수 있도록 수정하면 될 것 같음.



팀장님께 에러 보고

> Gift 배송 오류 건 보고 드립니다. (15:00 ~ 15:30)
> /payment/direct/srcard/request.do (39건)
>
>  - 원인 : SR카드 및 신용카드 결제/취소 히스토리 생성 시 송수신 내용이 4000바이트 넘어갈 경우 발생하는 오류 (Merge문 사용중)
>  - 조치방안 : Merge문을 Insert/Update로 분리 (현재 개발기에서 테스트 완료하였고 추후 스테이징 테스트 후 운영기 배포 예정)
>
> /payment/main.do (8건)
>  - 원인 : Thymeleaf 사용 시 null이 들어오면 안되는 변수에 null이 들어와 발생한 화면단 오류 (WEB회원 결제 화면 접속 시 SR 카드 리스트 불러올 때 간헐적으로 발생하는 것으로 추정)
>  - 조치방안 : 로그레벨 수정 후 정확한 원인 파악하여 수정
>
> /shipping/proc/register.do (16건)
>  - 원인 : 배송지 관리에서 주소 별칭 입력 시 한글6자(20바이트) 넘어갈 경우 발생 (화면단에 체크로직 있으나 복사/붙여넣기 통해 입력 가능)
>  - 조치방안 : 화면단 체크로직 보완 및 서버단 체크로직 추가
>
> /cancel/D2021080515021353161/execute.do (3건)
>
>  - 내용 : 주문 상태값 체크에 따른 메시지 처리용도로 실제 오류 아님
>
> 



## 개발환경 설정

### IP

대연각 2층 IP 

> 10.21.34.23
>
> 255.255.255.0
>
> 10.21.34.1
>
> 174.100.20.84
>
> 10.253.19.18

메사 7층

>10.21.37.147
>
>255.255.255.0
>
>10.21.37.1
>
>174.100.20.84
>
>10.253.19.18



### BO FO 기본 셋팅

이기프트샵 BO FO 셋팅설정

안녕하십니까. 신세계 아이앤씨 강성태입니다.



BO + FO 개발환경 구축방법 및 JDK 설치파일 경로(VDI 공유폴더) 를 전달드리오니 확인 부탁드립니다.



** BO **

\1. 이클립스 window → preferenced 內 settings.xml 적용 후 → maven install → maven update (참고사이트 : https://lovelytney.tistory.com/14)

\2. swaf-mon-mvc 內 enc~Path : 1.txt ~ 2.txt 프로젝트 內 파일 검색하여 로컬 폴더 경로로 수정

\3. GiftShopBiApplication.java 실행

\4. localhost:8484 호출 시 BO 화면 확인

  관리자 접속 ID : admin / pw : 1

  유저 접속 ID : gsadmin / pw : gsadmin12!@



** FO **

\1. 프로젝트 git pulling 후 settings.xml 로 메이븐 설정 
  ※ log cannot be resolved 에러 발생 시 lombock 재등록 후 프로젝트 refresh
  (재등록 법 : Maven-Dependencies - lombock~.jar 마우스 우클릭 - run as java application - specify location 버튼 선택 - 이클립스.ini 찾아서 선택 - install 버튼

\2. swaf-mon-mvc 內 spring.profils.active 설정 환경에 맞게 (필자는 local로 수행)
  enc~Path : 1.txt ~ 2.txt 프로젝트 內 파일 검색하여 로컬 폴더 경로로 수정
\3. GiftshopFrontApplication.java 실행
\4. localhost:9494 호출 시 testest 텍스트 출력 여부 확인

** JDK 설치파일 경로 **

※  [\\sgpvdifs01\Gift](file://sgpvdifs01/Gift) 배송서비스 도입 프로젝트\99.개인폴더\기타\공유



감사합니다.



### 통영 환경 셋팅 가이드(VDI)

통영 환경세팅 가이드 추가로 공유 드립니다. (VDI)

1. 네트워크 드라이브 접속 : \\sgpvdifs01\com
2. 폴더이동 : 신규인원 가이드\1.통영 & 넥사 JDK 1.7 환경설정
3. ppt파일 참고



### 주소 및 계정 정리


서버 리스트 확인하는법 : ITSM > 서비스처리 > 구성관리 > 구성현황



Bloosome : 210547/ Shinsep09!

BO prod : https://gifton.starbucks.co.kr/login/init.do

BO 계정 : 210547 / tlstprP1@# 

BO STG : https://stg-gifton.istarbucks.co.kr:4443/

BO 전체 계정 : admin , 1



인터맥스 url  : http://10.253.12.40:8082/intermax/RTM/ 

계정 정보 : starbucks / starbucks



http://10.105.48.91:8050/jenkins/

공용계정 : hp / !tlstprP1! 



metis

210547 / Shinfeb02!



통합정보시스템 (통영) 

http://10.21.21.11:8086

00210547 / Shinaug08!



유재희담당님 스테이징 스타벅스 앱 계정

173922/1

스테이징 임직원 할인 가능한 계정

ORANGETREEX  12345zxcvb



내 스테이징 앱 계정 정보
210547 / tlstprP1@#



VOC : https://ivoc.istarbucks.co.kr:8888/ 블라썸로그인하고 주소접속



DEV_MSR

10.105.48.53 /1521 / SCKMSRD

scmsr_rw / newshin_rw!23



MSR log 정보

/msrlog/msr9/web/giftshop



블라썸 계정 11월 이후

Shinnov11!



STG SR 카드 리스트 스테이징 카드 리스트 (사용후 컨플 업데이트)

https://confl.sinc.co.kr/pages/viewpage.action?pageId=61595690



gitlab 계정

210547@shinsegae.com

Shinmay05!





------------------------------------------------

### 운영기 서버, DB 접속 정보

- 통영 DB 접속 정보

  > Host : 10.103.48.22
  >
  > Port : 1521
  >
  > SID : SCKMIS2
  >
  > 계정 : SCKSA / scksa_pass
  > 통영 테이블 MSR.MSR500_SUB (SCKSC 에 있음)

* 개발기 DEV 

DEV_MSR
10.105.48.53 /1521 / SCKMSRD

sckmsr_rw / newshin_rw!23



* 기프트샵 운영기 정보

10.103.49.53,54 1521
 SERVICE NAME : LATTE
 ID/PW : US_GIFTSHOP/tlstprP3$%
 SR/XO 조회권한 DB : US_GIFTSHOP/tlstprP3$%

* 스테이징 nas 경로

  > https://stg-www.starbucks.co.kr:3443/upload/giftshop/display/

  

스테이징 테스트 는 사용자 이름(US_GIFTSHOP)과 비밀번호(US_GIFTSHOP)가 동일하다

* 스테이징(10.103.55.51),테스트 기프트샵

사용자이름 : US_GIFTSHOP

비밀번호 : US_GIFTSHOP

Servicename : LATTE



* 개발 기프트샵(10.105.48.53) 

사용자이름 : US_GIFTSHOP

비밀번호 : tlstprP1@#

ServiceName : LATTE



DR/운영기 (jeus)

개발/STG/TEST (jues8)

WEB (webtob)



패스워드 동일 tlstprP1@#



* msr admin stg (msr 어드민) msradmin

  >
  >
  >https://stg-msradm.istarbucks.co.kr:8080/login/login.do
  >
  >admin / 1111



### jeus 8 배포 관련

참고 ) vdi 에서 jeus 접근안될 떄는 jeus에 로그인하여 adminServer 의 Engine을 설정하면 된다. (lock & edit) 클릭 후 고급 설정으로가 허용 IP를 추가하면됨.

------------------------------

## 시스템



### bo 배치 켜기/끄기

swafmon property 에서 운영기(prod) qurtz 관련 useYN, clustered 를 'N' 으로 설정한 후 커밋, 푸쉬를 거쳐 배포하면된다. 

커밋 메세지 예시 : DB 작업 이후 배치 on



### 인터맥스

인터맥스 url  : http://10.253.12.40:8082/intermax/RTM/ 

계정 정보 : starbucks / starbucks

D2021072913535485248

스타벅스 서비스로 접속하여 coconut01_gift1, olive01_gift1 을 찾는다.



#### 한글아이디

개발기 : 아키니루 / tlstprP1@# -> 아키니루 / 1 변경

bmchoi5 / 1



### giftshop WAS(SSH) 로그 확인

ssh tool 사용하여 10.102.52.99, 10.102.52.100 의 로그 확인 (운영 1,2)

10.102.48.52 (개발WAS)

10.102.54.51 (테스트 WAS)

10.102.55.51 (스테이징 WAS)

아이디 jeus8 / tlstprP1@#

cd logs/olive/ 

tail -f giftshop-front.log



### 배포시스템

배포작업요청 -> 신규

>요청명 : [배송하기] STG FO
>
>프로젝트명 : Egift 배송하기 (나중에 MSR유지운영으로 변경될듯)
>
>배포환경 : 스테이징
>
>브랜치구분 : master ( dev ,master 있는데 왠만하면 master)
>
>배포정보 : [STG]GIFTSHOP-FONRT 소스커밋 (전체배포는 스테이징은 소스커밋하면 자동 전체배포 및 재기동이 되므로 소스커밋만 하면된다)

대상파일목록 -> 파일추가

> 가져오기 해서 최신상태로 유지하고 별다른말이 없으면 전체 선택하여 저장 하면 된다.
>
> 이후 1차 배포 -> 2차배포(svn이관) -> 배포 단계를 거치면 완료.

### 점검 후 배치 순차실행

 	엑셀파일 참고하여 순서 (1->99) 대로 실행, 순서와 관계없는것은 동시실행해도 괜찮다.  complete 확인해서 적당히 3~5개 돌리며 넘어가고 error 있는것은 즉시 보고 및 처리 해야한다. 에러 발생건은 수정후 재배포 후에 다시한번 돌린다. 이후 배치를 다돌리고 나서 처음 배치(오전 9시) 가 있기 전에 bo 배치 켜기/끄기 메뉴얼을 참고하여 배치를 재실행 시킨다.



### 배치관련 가이드(고시정보)

 I/F 영업정보 공통코드 마스터(46), 디테일(47), 고시정보마스터(41) 을 돌리면 된다.



### 배포 (개발기)

개발기 젠킨스

> http://10.105.48.91:8050/jenkins/
>
> 공용계정 : hp / !tlstprP1! 



### 배포시스템 배포요청 관련 가이드(스테이징)

배포작업요청 -> 신규

>요청명 : [배송하기] STG FO
>
>프로젝트명 : Egift 배송하기 (나중에 MSR유지운영으로 변경될듯)
>
>배포환경 : 스테이징
>
>브랜치구분 : master ( dev ,master 있는데 왠만하면 master)
>
>배포정보 : [STG]GIFTSHOP-FONRT 소스커밋 (전체배포는 스테이징은 소스커밋하면 자동 전체배포 및 재기동이 되므로 소스커밋만 하면된다)

대상파일목록 -> 파일추가

> 가져오기 해서 최신상태로 유지하고 별다른말이 없으면 전체 선택하여 저장 하면 된다.
>
> 이후 1차 배포 -> 2차배포(svn이관) -> 배포 단계를 거치면 완료.

### 배포 (운영)

배포작업요청 -> 신규

>
>요청명 : [배송하기] 운영 FO WAS
>
>프로젝트명 : Egift 배송하기 (나중에 MSR유지운영으로 변경될듯)
>
>배포환경 : 운영
>
>브랜치구분 : master ( dev ,master 있는데 왠만하면 master)

대상파일목록 -> 파일추가

> 서버 전체배포
>
> (대상파일 목록 더블클릭하면 나옴) 체크 해서 저장하면된다

### jeus 8 배포

** 로그와 함께 끄고 켜기

> 주소 : 10.102.52.99.9836/webadmin/
>
> 아이디 : homepagedas
>
> !tlstprP1
>
> front : olive
>
> bo : coconut
>
> server > olive01 stop & start > 완료되면 olive02 stop&start 



---------------------------------------------

## 인수인계

----------------------------------

### 정산 인수인계

#### 통영

e-Gift Item Daily Report -> 유형별 채널별 판매/사용 실적기준 탭 or 검색 '회계대체'

**배송상품 결제 유형별 조회 및 회계대체 (선수금 정산 화면)**

일반/제휴사/eGift Card 충전 탭

> 일반 :
>
> 제휴사 :
>
> eGift Card : 익일 취소를 제외한 취소에서 (모상, 기프트아이템) 발생한 금액

조회 : 통영 was <-> 배송DB

회계대체 : 통영에서 was <-> 통영 db



**정산**

전표상태 미처리 : 정산 안되었음(회계대체가 안되었다는 뜻 재무팀에서 1~3일 사이에 한다.)

합계 : 통영에서의 sr,신용카드ssgpay,egiftItem 데이터의 합계. 이 합계는 집계 테이블을 바라보고 있는다. BO의 결제수단별매출조회도 이 집계 테이블 바라보고 있고. 테이블은 매일 새벽 배치에 의해 돈다. 단지 통영에서의 선수금은 집계테이블에서 (결제금액 - 취소금액) 이 계산되어 나오기 떄문에 통영의 화면이 bo 집계 화면보다 적게 값이 나와있다.

결제원장 합계: 주문결제 테이블의 합계 (row 합계 group by)

전표 히스토리 I/F : 



**일자별 선수금 및 매출액 조회**

>선수금 : 당일 결제된 모든 금액
>
>매출확정 : 실제로 확정된금액(배송완료 후 9일)
>
>취소 : 당일 취소 된 금액
>
>누적 선수금 : 떠도는 금액들(현재 매출확정이 되지 않은 금액들)

일잡려 선수금 및 매출액 조회 메뉴와 매출관리의 매출확정은 같은 데이터를 바라보고 있지 않기 때문에 



선물거절취소 (45000원 취소 발생)

에러로 인하여 bo 에는 배송중인 상품이 신용카드로는 45000 원 취소 발생했음.









### 주문 취소 관련

주문 실패 : 결제 데이터 정상 , 주문데이터상태 비정상

> 주문할때 결제 성공해서 고객 돈이 빠져나갔는데 주문 상태가 비정상

주문 취소 실패 : 결제 데이터 정상, 취소 로직에서 비정상 케이스 발생

> 주문 성공 이후 주문을 취소하려는데 츃소가 비정상이여서 고객의 돈을 못돈려준 상태이면서 주문상태가 주문 취소 실패



### 20210719 인수인계 ( bo 및 정책)

20210719 인수인계

Q. history back 

best 10개

비회원은 교환전에도 발신자에게 교환을 요청해야함



리워드 (한번 등록한 별적립 이벤트는 수정/삭제 불가) : 

복합 결제 : 결제수단별 배송비 차감 우선순위가 존재한다. 

중복 리워드 이벤트 등록은 가능하나, 사용 여부 항목을 제외하고는 수정 불가!



미지급 상황 ? 



* 재고

누적할당수량 : BO재고

할당수량 : BO에서 실제로 가져올 수 있는 수량

잔여수량 : 실시간



합배송 ( 현재 5 개 )  : 



* 정산

반품 확정시(반품 주문들만) 인벤으로 정상

a ,b 가 있으면 b 를 반품했다. 구매확정이 되던 안되던 a가 구매확정되고 b는 반품처리되어 넘어간다.



9일 배치 구매확정

동일 상품일 때 부분반품 : 반품주문 들고있다가 원주문구매확정 될때 다같이 인벤으로 정산 넘어간다.

구매확정전 반품 : 

다른 상품일 때 부분반품  : a, b 샀는데 b 반품 (b 입장에선 전체반품) (a입장에선 부분반품) , b에서는 반품확정 주문이 인벤으로 넘어가는데 a주문은 구매확정이 안됬으므로 b주문에대하여 원주문과 반품주문을 인벤에 넘김.



* 구매확정전

=> 즉 동일 상품 부분반품일떄는 구매완료전까지 반품주문을 들고 있다가 원주문 구매 확정 될떄 넘어감

=> 다른 상품 부분반품 일때는 반품 주문 완료시 반품주문과 원주문을 인벤에 넘기고, 반품하지 않은 다른 상품은 원주문이 구매확정일떄 인벤으로 넘어간다.

* 구매확정 이후

=> 이미 보냈기 때문에 그냥 들어온 반품주문에 대하여 원주문과 상계처리 한다.



* 전체 반품일때 : 인벤이 반품이 원주문과 비교하여 원주문과 반품확정 처리를 해버린다. 



다시 !! 

* 동일상품 부분반품 : 

a 두개샀음. 하나 반품하면 반품확정되면서 sap에 -10000 원.

*  다른상품 부분반품 :

a, b 2 사면 

--------------------------------

### 20210721 인수인계 (프론트 구조 및 추후 인수인계 방향)

기술스택 : 스프링부트, 



com.shinsegae_inc : 기본적으로있는 신세계 core

kr.co.starbucks.giftshop : 작업내용



biz : 비즈니스(도메인) 별로 패키지 구분했음

> 패키지에서 apiContorller는 서비스 진입과 관계없는 개별적 로직처리를 할때 사용
>
> mapper : mybatis 호출전에 prefix 정의 (dao)
>
> dto : model 용 객체
>
> vo : view 용 객체

resource 

> resource > swaft-mon-mvc.yml : 프로퍼티 설정 관리 파일
>
> 권고 방향 : branch 를 stg, dev, prod(master) 를 로컬에서 따서 merge 하는형태로 개발을 한다.
>
> 
>
> lucy-xss-servlet-filter-rule.xml : 크로스사이트 관련 설정파일
>
> logback-spring.xml : 로그 관련 파일
>
> application.yml : 스프링에서 참고하는 설정파일 (indent 띄어쓰기 유의)
>
> templete 패키지 : 화면단을 정리한 패키지 (타임리프 사용)

jndi ? : 



타임리프 : 

> main > maincontroller (main.do) : 
>
> layout, fragments 는 필수적인 부분

publish : 퍼블리셔의 부분 



include_header 

> babel, polyfill : for ES6

utils.js 

> es6 문법 설명
>
> th -> js 사용법

js > request

> fetchApi 를 일반적으로 사용하나 필요하면 ajax도 파일에 메소드를 두긴 했다.
>
> response.ok 는 항상 200(정상)을 나타낸다. 신세계의 appScan이 오류를 받지 않음.
>
> resource > message  : restAPI , 화면 error cosntants 있다.



주문, 반품 코드가 복잡하므로 먼저 분석하고와야한다. (배송비 계산)



dev.do 에서 테스트할 수 있다.

--------------------------

### 20210726 인수인계 (FO) 

신슬기 차장님 (cocoacoke@circlem.co.kr)



#### 취소

주문번호/items.do 를 통하여 연결



GS_COMN_CODE :   DB 에서 상태 코드 정의되어있는곳 

> TRG_DVSN_CODE : 취소 귀책 사유에 있어서 이미지가 필요한지 필요한 상태 코드
>
> DLT_YN : 
>
> GROUP_CODE = 'RTN001' : 반품
>
> GROUPCODE = 'CNL001' 취소 ?
>
> 취소예정 : 반품 요청했을때



CancleController.java : 취소 컨트롤러

> // 결제 취소액 중 모바일 상품권 사용액이 있고 익일 취소인 경우 회원정보 조회
>
> 개인정보가 배송하기 서비스에는 존재하지 않아서 SR에 요청해야한다. MsrDto.memberInfoReq 를 통하여 memberEntity 에 담음.
>
> selectPolicy : 

CancleService.java : 취소 서비스

> 부분취소는 없음. 
>
> getOrdCancle : 
>
> GS_COMN_CODE : 상태 코드 정의되어있는곳



SessionInterceptor.java : dev.do 들어갈때 강제로 세션 넣어줄 때 사용 

> 세션 서수빈 담당님꺼 풀고 테스트 해보기



신용카드 현금영수증 발생시 검증 로직 있는지 확인!



intellij DB 연동하는 확장프로그램 설치하기

SSL 어디서 허가 받았는지 ? 



#### 반품

ReturnController.java

> AfterOrderCode 로부터 enum을 가져온다.
>
> reapy.do : 검증로직 다양하게 해두었다. 앱스캔 모의해킹때 이방식 채용하면 좋다.



ReturnService.java

>반품 가능수량 조회, 체크
>
>이후 반품 가능 수량 큰녀석들만 리스트를 반환받으면 

Retrun.java : DTO 분석해야한다.



RepayService.java

> sr카드는 인증자체는 없고 로그인을 함에 의의를 두기 때문에 



방대해서 직접 코드를 보면서 분석해야 이해가 갈 것같다. 설명으로 이해하기에는 안맞음.



MsrApiCode.java 참고 : stg 에서는 푸시테스트 불가. 운영에서만 가능 ...(?)



#### 교환

반품과 유사

---------------------------------

### 20210727 인수인계(bo) - 주문 관리 및 배치



#### 배치, 인터페이스 (안정훈 부장님)

배송요청 배치: 결제완료(01) + 배송지 입력 인 것을 GS_INTRF_HSTRY 에 대상을 넣는다. 마스터와 상세 (1:N)을 한번에 업데이트 해주는 쿼리.

> targetCntList : 히스토리 테이블에 쌓고 히스토리 테이블에 개수를 넣음
>
> ifHistoryList  : 넣은 개수 와 확인한 개수를 찾도록 검증?

주문확인 배치 : 배송요청(10) 상태를 배송준비중(11) 으로 바꾸는 배치

>  수정일 기준 전일 06시 익일 17시 대상인것을 새벽 1시에 돌아간다.

배송완료 배치 : 배송중(12) 을 배송완료(13) 상태로 변환

> 배송중(12) 인 상태에서  배송비(7)는 제외하고 송장번호 잇는거 가져옴
>
> delvyTrackUtil 에 (택배사 api) 에서 delivered 라는 상태값이 리턴되면 배송완료(13) 으로 처리한다.

구매확정(별, 쿠폰) 배치 : 배송완료(13) 를 구매확정(?) 으로

> 배송완료일을 포함하여 9일차 되는날, 마스터 1건과 상세 n건이 모두 배송완료가 되야만 
>
> 교환 인것은 수거 완료가 되면 바로 구매확정
>
> 
>
> 쿠폰 대상(GS_CPN_ISNG_DTLS 구매확정시 쿠폰발급대상 테이블) 조회하여 (최종상품 판매수량 * 판매상품 쿠폰발급 수량) 만큼 발급
>
> 쿠폰 대상자 업데이트 쿼리
>
> 
>
> 별발급 대상 잡는 쿼리(반품관련 제외)
>
> /* 결제 이벤트 */ : 상품 당 지급 별갯구 계산 ,이벤트 관련 테이블에서 GS_EVENT_MNGMN 참고해서 등록
>
> /* 결제 이벤트 2 */ : 결제 금액당 지급 별갯수 계산 */ 
>
> /* 결제 금액 */ : 순수하게 기본 별 금액 정책
>
> 별지급 관련 테이블(US_GIFT.sakfjaise) 에 기존에 조회한 지급 대상자에 한하여 지급 수량을 삽입한다.
>
> 교환확정 된 것은 구매확정 시킴
> 
> 
>
> 이후 별도로 오전 10시에 별지급 배치가 돈다.

구매확정 후 쿠폰발급 요청 배치, 별지급 요청 배치

> CPN_ST = 01 인것을 찾아서 SR api 통해서 지급 한다.

 교환배송완료 배치

> 배송완료 배치와 유사

배송지 미입력 대상자(수신자,발신자) 노티파이 배치

> 

장바구니 삭제

> 등록일 , 수정일 인데 현재 등록일을 바라보고 있다. 수정 필요하지 않을까 ?

판매상품 색인 : 프론트쪽 상품 정렬할 때 정렬 기준을 만들어 주기 위함(best 상품)

> 구매확정 건들 에 대하여 색인

개인정보관련 : 

> 주문마스터, 주문상세, 결제마스터, 결제상세, 배송지 테이블 5개 파기 관련 배치

인벤 할당재고수량 조회 및 UPDATE : 

> 인벤쪽에 조회해서 할당 재고수량을 update
>
> Q. 할당 재고수량 : 인벤에서 bo 쪽으로 할당해주는 재고 수량
>
> 인벤 쪽이 우리의 util을 못접근해서 우리가 인벤을 바라본다.

LMS 전송 결과 조회 후 푸시발송 : 

> 제대로 발송이 안되면 front 에 다시 요청해야함

회원탈퇴한경우 bo도 대상 처리 배치 :

> bo 에서 사용자 id를 가지고 query 돌려서 확인 해서 대상있으면 복원, 보간 처리 했음.

인터페이스

>각 액션이 필요할 떄마다 인벤에 넘겨줘야 하는 정보들이 있음.

#### 주문관리 화면개발

> swaf > resource > admin 에 대부분의 화면에 필요한 소스들이 들어가있다.

주문관리 화면 : 

> bo 화면은 모듈없이 단순 개발을 하여서 복잡하지는 않다.

OrderController.java

> 주문관리 화면 
>
> 주문상세는 orderDetail.do 화면 그리고 
>
> 주문 상세 화면은 주문, 교환, 반품 관리에서 동일한 상세화면을 사용하고 있다.

Q. groupcode Constant 가져올 때 경로가 들어날 때 보안 문제 없는지 확인하자('$@kr.co.starbucks.giftshop.admin....@ORD002)'

#### 주문관리 기능구현

취소 

> CancleServiceImp.java
>
> 판매자 결제취소
>
> 품절취소
>
> 반품승인
>
> 반품요청철회
>
> 배송지 미입력 결제 취소

api 로직(MsrApiUtil.java)

> web연동규격서_배송서비스 도입.word 참고
>
> 회원정보조회

-------------------------------------------------

### 20210727 인수인계 (fo) - 카트

#### 판매 상품 상태 체크 

- productvalidationService.java : 상품의 현재 상태 가져오는

  getProductValidData 

>  cnsnt_st_code : bo 에서 등록시에  상태이다 => (02) 승인, (01) 임시저장, (03) 미리보기
>
> 그러므로 프론트에서는 (02) 승인인 것만을 사용해야됨.
>
> use_YN (정상적으로 등록되었음)도 Y만 사용
>
> invent_qnty(재고) > 0 만 가져오기

​	getCartItemValidata

> 카트 순번을 기준으로 상태 체크 

#### 카트 

- cartService.java

  isPsblBuy(Cart cart) : 구매하기 선물하기 카트 담기 떄 사용하는 개수 체크 로직

  > 상품의 인당,상품당, 회당 수량을 체크하는 로직이 들어가있다.

  isPsblReturn : 교환 가능여부 체크

  > 판매중인지 확인하기 위하여 boolen 값으로 ? 

  isCartItemCountUpdate : 카트내에서 상품수량 체크 그에따라 메세지 토스트

  

  isPsblCartAdd : 카트에 담을 수 있는 최대수량 체크(30개)

  

  cartItemPsblBuy : 카트에 담긴수량을 구매/선물하기 넘어갈때 체크

  

카트 담는 로직에 관하여

>구매/선물을 할 때 사용자 눈에는 보이지 않지만 카트에 넣었다가 구매를 한다. 나에게 구매하기 컬럼, 즉시 구매컬럼(선물하기 + 나에게 선물하기)  에 삽입된다. 즉 나에게 구매하기, 즉시구매 하기 컬럼이 N 인것이 사용자가 카트에 담은 상품이다.

- cartController.java

  selectCartList : 장바구니 목록 조회

  > gds001 (상품 상태관련enum 을 typehandler로가져오고 있다)

  removeCartItem : 카트에서 dltYN 을 update 해주는 방식으로 지운다.

- CartApiController : 다른 model 에서 cart의 정보가 필요할 때 사용 

  cartToTalCount 

  createCartItem : 상품에서 카트 담기

- request.js
- util.js : throttleFn = 여러번 눌렀을떄 한번만 누르도록 되도록 

#### My배송 

##### 주문/배송 현황 

> 메뉴는 bo에서 정보를 가져와 뿌려준다.(홈, 베스트, My배송)
>
> shippingSt Dto 를 통해서 주문/배송 현황을 뿌려준다.

##### 선물함

- GiftCriteria dto : 보낸선물함 필터, 날짜 셋팅

- GiftboxCode.java : 공통 코드들

- OrderPager.java : 선물함에서 스크롤 내리도록 한번에 데이터 가져오는 부분

- GiftboxController : 보낸 선물함 ,받은 선물함 구분할 줄 알아야한다.

  > readCancleReceipt : 취소 영수증 관련
  >
  > Popup은 girtCriteria.java 의 popUp enum 을 header로 사용하여 gift_full_popul.html 이용한다.

- cancle_return.html : 결제/환불 이력

- 상품코드(70) 인경우에는 관리자가 반품할 수 있도록 여는케이스

##### 주문내역

afterOrder > orderListController.java

>  보낸선물함과 유사하다. 받은제품 원주문 기준으로 모두 노출쿠폰 발송여부 추가 되었다.

화면은 order 에 있음



##### 배송지관리 

화면 뿌려주고 배송지 수정 삭제 하는 기능

- ShippingController.java

  > readSendGiftDetail : 네이티브 담당자들이 요청할 떄 gitNo 이용한다.

- ShipopingServiceImp.java

- ShippingApiController.java 

  > 결제 파트 담당님이 작업하셔서 패스

-----------------------------------------------

### 20210728 인수인계(bo) - 판매상품관리 (성필규 님)

상품(goods) 디렉토리에 존재한다. 할당재고수량 및 이미지 관련 코드가 복잡하다. 이 외에는 간단.

#### SKU 조회

sku 마스터는 통영에서 가져온다.

#### 할당재고수량, 수량 할당

제일 복잡한로직 부분.

> 할당 재고수량 :
>
> 인벤에서 bo 로 넘겨주고 그 수량을 bo에 저장한다. 실제로 bo에서 사용하는 데이터는 bo의 할당재고수량 컬럼값이다. 상품 등록을 하거나 수정을 할때 값이 변화된다. GS_RSRC_MSTR(스쿠마스터) 의 ACLTM_INVENT_QNTY 에서 받은 재고할당수량을 bo 시스템의 MNGMN_QNTY 로 옮긴다. 이후 bo 재고만 차감됨 
>
> 상품별 할당수량 : 
> 상품등록을 하고나서 상품별로 가지고 있는 재고 수량이다. 반품 주문 취소 시 값이 변화된다. GS_SELL_GOODS_INVENT 의 INVENT_QNTY 가 반품, 주문시 차감됨

#### 이미지

대표이미지 불러오는 방식 skumapping table 와 sku에서 가져오는 두가지 방식 있다. 까다 로울 수 있어서 코드 유의해야한다.

> 파일은 multipartformdata 링크있는것은 linkUrl이 전송되어 이후 이미지 불러오기에 대한것들에 대하여 filnames-linkURL 과 연동하여 맵핑한다.
>
> ** 파일 이름이 같은 경우에 순서를 보장하지않는 거에대한 예외처리 안되어있다.

#### 화면

main, category, 검색 부분 구현하였음. 필터 관련 부분 구현이 라이프사이클 관련해서 까다롭다.

main(홈화면)

> 단순하다.
>
> 상품 마스터 색인 테이블을 참조해서 단순 정렬.
>
> 
>
> 카테고리도 카테고리 테이블
>
> 
>
> 배너도 배너테이블, 배너가 내부링크, 외부링크, 팝업, 페이지이동 4가지 케이스가 존재하여 예외가 발생하기 쉽다. 그런데 이번에는 외부링크만 가능하도록 하였다. 왜? 현재 앱에서 외부 풀팝업을 막아두고있다.
>
> 현재 풀팝업처럼 보이지만 레이어 팝업을 풀팝업처럼 한거다.
>
> 내부링크+팝업, 내부링크+논판업 등등 .. 분기처리해서 해결하고있다.
>
> 내부링크 제외하고는 전부 레이어 팝업으로 구현되어있음.
>
> 
>
>
> 홈(main) 의 베스트와 베스트 탭의 베스트는 다르기떄문에 각각 작업해줘야한다. 
>
> +) 다른고객상품

필터, 검색

> 현재 타임리프 라이크사이클과 연계되어있어서 구현이 까다로웠다.
>
> 카테고리별 필터내용을 가져오는 api 가 구현되어있다. 
>
> 필터 유형을 클릭했을 때 클릭한 버튼이 아래에 노출되고 사라지는 것도 유의해서 봐야한다.
>
> sort 의경우에는 각자 관련코드에 가서 sort를 찾아야한다.

#### 히스토리 관리

** 현재 도큐먼트에서 제공하는 히스토리가 아닌 히스토리를 직접관리하고 있다.

request.js : 공통으로 쓰는 자바스크립트 코드

> ** moveToView : 앱에서 get을 막아 두었기 때문에 모든 요청을 post로 처리하고 위한 함수. 그래서 form 으로 날려서 단순 링크도 onClick 을통하여 post 를 moveToView 를 날리고 있다. 공통으로 만들어둔 view_header.html 의 formheader 의 내용을 사용한다.
>
> 
>
> ** sbGShisory : 히스토리를 sessionstorage 에서 관리한다. 주문과 같이 뒤로 돌아가면 안되는 경우가 있어서 세션스토리지(앱닫앗을떄 날라가야하므로) 에 저장하기로 했다. 실제 페이지 이동할 떄 push 로 히스토리 이동하고 moveToView 를 이동한다. 실제로 뒤로가기가 아닌 포워딩의 개념. 필터의 히스토리도 관리하고 있다.

#### 이벤트, 배너, 메뉴 관리 하는 법

> 메인 메뉴 : gs_mainmenu
>
> 메인메뉴테이블에서 추가하면 탭에 메뉴를 추가할 수 있다. event 메인 + 상세 구현해두었다.
>
> 퍼블으로 할경우에는 이벤트나 배너에 해당하는 부분에서 event.html 에 퍼블링크 달면 된다.
>
> EventController.java (event.do)  : event 에서 menu 안나오게 하고싶으면 menu 관련 코드 주석처리하면된다.



딥링크

> 스테이징 : starbuckskr://deeplink?main=GIFT_DELIVERY&sub=DETAIL&url=https%3a%2f%2fstg-www.starbucks.co.kr%3a3443%2fevent%2fdetail.do
>운영 : starbuckskr://deeplink?main=GIFT_DELIVERY&sub=DETAIL&url=https%3a%2f%2fwww.starbucks.co.kr%3a3443%2fevent%2fdetail.do
> 스테이징 (헤더포함) : starbuckskr://deeplink?main=GIFT_DELIVERY&sub=DETAIL&url=https%3a%2f%2fstg-www.starbucks.co.kr%3a3443%2fevent%2fdetail.do%3FheaderType%3DTYPE2
>운영 (헤더포함) : starbuckskr://deeplink?main=GIFT_DELIVERY&sub=DETAIL&url=https%3a%2f%2fstg-www.starbucks.co.kr%3a3443%2fevent%2fdetail.do%3FheaderType%3DTYPE2



------------------

### 20210729 인수인계 (bo)  - 주문



#### 주문서화면(payment)

sr 카드 여러개 선택할 떄는 우선순위(먼저클릭한순서) 대로 결제된다. 모바일 카드를 선택하여 금액이 차감되면 우선순위가 낮은 카드들 부터 클릭이 캔슬됨.



** 쓱페이 열때 주석위치 

> paymentsCards.html 의 radioWrap class 의 idx.idex < 3로 설정해준다. (2->3)
>
> inisiscontroller 에 구현되어잇는 것을 sggpay 에도 맞추어서 해야한다.
>
> ~~DB에서 US_GIFTSHOP 의 GS_COMN_CODE , code_dscrt = ssgpay 에 해당하는 row의 DLTYN를 Y로 설정해주어야한다.(이거아님 ! 임시)~~

#### 결제

결제 완료 로직 :

>** 자료사진 참고하여 코드 학습해야한다.
>
>vdi 에 pg 사 ip 뚫어야한다. ksmobile.inicis.com 
>
>유효성 체크 이후 통과하면 원주문 번호 생성 + 주문서를 생성하고 pg 사에 결제창을 호출하게된다.
>
>Q. 오래걸렸을 떄 이게 로컬이슈인지 아닌지 어떻게 판단했나?
>
>Q. P_TID 공부해야한다.
>
>pg 사에 대해서 요청이 이루어지면 그때 msr 결제정보가 요청된다. (연동규격서 확인해서 결제처리 api 확인하면 어떤 정보들을 보내는지 알 수 있다.)
>
>만일 pg 사 승인 이후 msr 에서 실패하면 그에따라 pg사 승인을 철회한다. 만일 pg 승인도 실패하면 bo에서 이력이남아 처리할 수 있다.

진입로직(PaymentSrCardController.class + paymentValidation.class + paymentFunction.class)



결제취소 로직 

> netCanclation(망취소), 일반취소(canclation) 을 tid + dlvyOrderNo 조합으로 취소시켰다.



#### LMS 메세지 전송화면



#### 비회원(웹티켓) - 배송지등록, 수정

웹티켓에서 배송조회를 눌렀을 때 앱이 설치되어있는 회원이면 주문내역이 앱으로 이동하게 된다. 그래서 비회원에서 입력하면 앱을 안띄우도록 로직을 변경하였음(웹으로만 연결되도록). 

인증번호(숫자)로 sr 에 회원인증 이후에 강제로 회원이 아닌 번호를 보냄으로써 비회원으로 연결됨

-------------------

### 인코딩 및 dev.do 셋팅 관련

#### 인코딩

apiUtil.Java & msrApiUtil.java 에 mapToQueryString 에서 encode가 된다. build(false) 설정하면 인코딩안할 수 있음.

#### dev.do 셋팅 관련

run as configuration -> vm.options -> Dspring.profile.active = local  설정

msr-dev 방화벽 해제

sessionInterception.java 에서 특정 계정 해제하기

-----------------------------

### FO 주요 코드 리스트

안녕하세요. 신슬기입니다.

Fo 에서 미리 보고 오시면 좋을 내용을 미리 공유드립니다.



url 대략적인 흐름.

>\1.  메인 : /main.do
>
>\2.  카테고리 : /category/items.do?categoryCode=400
>
>\3.  상품상세 : /detail.do?goodsCode=31
>
>\4.  장바구니 담기 : /api/cart/item/new.do  
>
>body : {goodsCode: "31", goodsQnty: 1, imdtlBuyYn: "N", gfmyYn: "N"}
>
>\5.  바로구매(담기) : /api/cart/item/new.do  
>
>body : {goodsCode: "31", goodsQnty: 1, imdtlBuyYn: "Y", gfmyYn: "N"}
>
>\6.  장바구니 : /cart/list.do
>
>\7.  장바구니에서 나에게 선물하기 : /api/cart/items/check.do
>
>Body :
>
>{srnms: ["4719"]}
>
>\8.  주문전주소선택 : /shipping/list.do?srnm=4721&buyType=01
>
>\9.  주문서 : /payment/main.do?headerType=TYPE2&buyType=01&srnm=4721&dlvyAdrsSrnm=53
>
>\10. 결제요청 : /payment/direct/srcard/request.do
>
>/Body :
>
>\11. 주문상세 : /order/D2021070614075783321/detail.do
>
>\12. 주문취소가능여부조회 : /cancel/D2021070614075783321/check/items.do
>
>\13. 주문취소신청 : /cancel/D2021070614075783321/items.do
>
>\14. 주문취소가능여부조회 : /cancel/D2021070614075783321/check/items.do
>
>\15. 주문취소 실행 : /cancel/D2021070614075783321/execute.do?orderModifyReason=02&headerType=TYPE1
>
>\16. 주문취소완료 : /cancel/D2021070614075783321/complete.do
>
>
>
>결제
>
>PaymentController.selectPaymentMainView (/payment/main.do)
>
>PaymentSRcardController.paymentSrCard(/payment/direct/srcard/request.do)
>
>PaymentINIController.selectIniPaymentView(/payment/gateway/inicis/main.do)
>
>
>
>
>
>취소
>
>CancelController.executeCancelRequest (/cancel/D2021070614075783321/execute.do)
>
>
>
>반품
>
>ReturnController.selectPaymentMainView ( /return/ D2021070614075783321/repay.do )
>
>ReturnController.executeReturnRequest (/return/D2021070614075783321/execute.do)
>
>RepaymentController.paymentSrCard(/repay/direct/srcard/request.do)
>
>
>
>교환
>
>ReturnController.executeExchangeRequest (/exchange/D2021070614075783321/execute.do)



## 기타 정리

### 동시접속자/TPS 문자 안내 (안상현 담당님)

>1) 매일 6시 ~ 22시 45분경 동시접속자/TPS SMS 문자가 전송됩니다. (매시간)
>
>2) coconut과 olive 컨테이너 DOWN시마다 down했다는 문자가 전송됩니다. 
>
>홈페이지나 SR 담당자도 같은 문자 받아서 기프트 운영 담당님들도 추가했고요... 문자가 자주 와서 불편하시면 따로 말씀해주세요

인터맥스 url  : 

### 법인카드 사용관련

<법인카드>
https://card.sinc.co.kr/bizplay/main_0003_01.act

수주번호 (프로젝트 진행 있을 경우) : SO21030554
식대/차대
상세내용

 - 업무미팅 음료/다과
 - 티미팅 음료
 - 야근 식대



### 공지 메세지 정리

#### 점검 후 서비스 점검 메세지

기존 예정 되어있던 작업들 안내(1 + 2)를 다음과 같이 나열하면된다.

> 차주 이벤트 대응 작업 및 서비스 확인 완료 되었습니다.
> 1) 웹투비 설정 변경
> 2) 제우스 컨테이너 설정변경
> 3) 작업 시간대 중단 되었던 배치 실행 완료

#### CPU 증설 후 모니터링 메세지

인프라팀에서 행동을 하면 그에 맞게 메세지를 작성하면됨

인프라팀  :

> cooconut 01, olive 01 서비스 다운하겠습니다
>
> 혹은
>
> cooconut 01, olive 01 재가동 하겠습니다.
>
> 하면 서비스 모니터링 후에 답변 달면 된다.

이기프트팀 : web/was 로그를 각각 확인한다. 그후 답변 달자 1번이 다운되면 2번 정상 알려주고, 2번 다운시키면 1번이 정상적으로 돌아가는 것 알려준다. 증설 작업 이후 해당 증설한 서버 정상 가동 알린다.

> - coconut02, olive02 모니터링 결과 특이사항 없습니다.
>   - WEB/WAS 로그 특이사항 없음
>   - 인터맥스 특이사항 없음

완료 이후 메세지 

>주문/결제 등 테스트 진행 하겠습니다.
>
>
>
>주문/결제 이상없이 잘 됩니다. (iOS, aOS)
>- 상품 목록/상세, 장바구니 등
>- SR카드 및 신용카드 결제/취소





### IP 정리

대연각 2층

>  10.21.34.23
>
> 255.255.255.0
>
> 10.21.34.1
>
> 174.100.20.84
>
> 10.253.19.18



### 임시 

스타벅스 별회수 에러 관련 상황 정리

>구매확정 : 
>29일 오전 7시 30분에 되어서 별 3개 적립 예정
>
>반품신청(재결재) : 
>7월 29일 오전 8시 30분에 완료
>
>별지급 시점 :
> 7월 29일 오전 10시 별적립 +3
>
>별회수 시점 :
>(1) 7월 30일 오후 4시 별회수 타임아웃에러 발생 
>(2) 7월 30일 17:32 별회수 -3



### 에러관련

#### SR 문의 사항

결제 푸터 안뜨는 케이스 : 고객 정보 확인해봐야함.. 재현 어렵다.

>Q. 배송하기 주문하려는데 결제가 안 됨
>내 계정에 대한 결제가 막혀있음
>핸드폰 기종에 대한 문제가 아니라며 강성 미수긍
>내 핸드폰으로 남편 계정 로그인 시 결제 부분이 뜸
>내 계정으로 로그인했을 때만 안 뜸
>이전 상담 시 상담원한테 로그인 해서 확인해달라고 했음
>상담원도 내 계정 로그인 시에 결제 부분이 안 뜬다고 함
>왜 내 계정에 대한 결제가 막혀있는 건지 의문임
>
>고객 id : jsmemsahib 
>
>고객서비스팀확인결과, 웹회원이고 결제당시 sr카드에 11,700원이었을거라합니다 (4/14 후 11,700원이다가 8/8 자동충전 5만원 해서 현재 잔액 61,700원입니다) 

주문 취소 실패 : SR API 실패, 

> ◆ 요청 내용 : 현재 고객님 해당 건 취소를 원하는 상황으로 취소 실패 사유 확인 요청드리며, 취소 가능 여부도 함께 확인 요청드립니다.
> - 취소하려고 누름
> - 취소 실패했다는 메시지와 함께 고객센터로 연락하라는 문구가 뜸
> ◆ 주문 번호 : D2021080515034928264
>
> 원인 : sr api 에서 주문 생성 실패 응답. 상세한 내용은 sr 측에 현재 문의중
> 취소처리방법 : 운영 db 수정을 통하여 bo에서 취소해야함. sr 및 db 영향도 분석 이후 내일 진행 예정.



> 2021-08-07 오후 01:04:11 에 /giftshop/paymentCancle , orderNo=D2021080515034928264, userID=POOHFAMILY81 으로 요청 보냈는데 비정상 응답이 왔음.  첫번째  SR 카드의 응답이 ResultCode : "00", ResultMessage : "FD redemption Success(롤백)" 두번째 SR 카드의 응답이 sbcReaminAmt : -999 와 함께 resultCode : 99 , FD 연동 실패 NO_PREVIOUS_TRANSACTION 상태가 왔음. 



### 파일 질라를 이용한 임시 배포

/sck/app/giftshop-front/WEB-INF/classes/templates/views/ 에서 bk 파일 만들어서 로컬에서 이동하여 테스트 배포(임시로) 할 수 있다. class 파일 옮기고 jeus 에서 재기동하면된다.



## 통합문서 마크다운 작성 가이드

목차는 [TOC] 를 이용하여 생성

큰 주제를 다룰 때는 하나의 주제를 다룰떄는 ##(h2) 사용한다.

소 주제는 ###(h3) 

상세 설명을 이용할떄는 '>' 이용한다.



#### 프리퀀시 딥링크

배너

/detail.do?goodsCode=73

딥링크

starbuckskr://deeplink?main=GIFT_DELIVERY&sub=DETAIL&url=https%3a%2f%2fwww.starbucks.co.kr%3a3443%2fdetail.do%3fheaderType%3dTYPE2%26goodsCode%3d73



viewheader 에 closewindow() 사용해서 배송하기 종료하면된다.



#### 인텔리제이 설치

license 홈페이지 접속
https://www.jetbrains.com/shop/download/II/2021200?_ga=2.181332270.826277159.1634516370-700609211.1634279282

zip 파일 다운 후 VDI 에 옮기기

vdi 에 옮겨야할 파일

oracle8-12.2.0.1.jar

lombok-1.18.10.jar

idealU-2021.2.2.win.zip

PortableGit-2.33.1-64-bit.7z.exe



그 후 setting git -> portablgit에 있는 git.exe 등록

lombok, oracle 은 lib 폴더로 이동

딥링크

> starbuckskr://deeplink?main=GIFT_DELIVERY&sub=DETAIL&url=https%3a%2f%2fwww.starbucks.co.kr%3a3443%2fcategory%2fitems.do%3fheaderType%3dTYPE2%26customEvent%3dY%26customEventNum%3d61

#### log4j 이슈

넥서스 주소

[Nexus 신규 라이브러리 등록 - 인터내셔날팀 - Confluence (sinc.co.kr)](https://confl.sinc.co.kr/pages/viewpage.action?pageId=41646941)



http://10.102.55.56:8050/nexus/#welcome



#### 통영 MSR대사 , PG대사 케이스 1

안녕하세요.

재무관리팀 김동우_세븐 입니다.

 

아래와 같이 대사 차이 발견 되었습니다.

해당건 오늘 내 정리될수 있도록 즉시 확인 요청드립니다.

 

또한 오늘 추가 차이가 발생하지 않도록 모니터링 요청드립니다.

| **No** | **거래일자** | **입금일자** | **결제구분** | **결제수단** | **매입사** | **TID**                                  | **누락상태** | **승인번호** | **MSR** | **PG****사** | **차액정보** |
| ------ | ------------ | ------------ | ------------ | ------------ | ---------- | ---------------------------------------- | ------------ | ------------ | ------- | ------------ | ------------ |
| 5      | 2021-12-29   | 2022-01-05   | e-Gift 배송  | 신용카드     | 롯데카드   | INIMX_CARDistarbuc0520211229235532765744 | MSR 누락     | 62232113     | 0       | 3,700        | -3,700       |
| 6      | 2021-12-30   | 2022-01-06   | 사이렌오더   | 신용카드     |            | INIMX_CARDistarbuc0220211230113515525065 | MSR 누락     |              | 0       | 10,100       | -10,100      |

Q. 12-29 거래일자로 MSR누락이 발생하였는데요. PG사 3,700 원 , 차액정보 -3,700 원이란 의미가 무엇인가요 ? (12/31 에 수동으로 결제취소 하였음 롯데카드 + 모상)

A. pg에는 3700원 결제상태로 남아있고 sr에는 없는것이다. 
1.sr은 결제 - 결제취소되어서 없는거일수도있다.
2.pg만 결제되어서 아예 sr 결제데이터가 없는 것일 수 도있다.

pg취소요청된거면 취소 후에 sr에 데이터 넘어오므로 취소요청을 하였다고 회신하면된다.

Q. 저는 대사가 있는걸 통영 -> PG정산관리 -> 이니시스 대사 에서 확인하는데 MSR.MSR500_SUB 에 해당 데이터가없다. 무슨의미?

A. 이니시스 대사는 하는일이 영업정보 pg 테이블이랑 MSR.MSR500_SUB 이거랑 대사를 한다. MSR.MSR500_SUB  여기에 데이터가 없어서 저렇게 대사로 나온 것이다. 즉,  pg 결제만 된 케이스일 수 있다. pg 취소 처리하였다고 강동우 파트너에게 내용 공유하면 됨.





